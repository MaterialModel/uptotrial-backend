# Product Requirements Document: FastAPI-based Clinical Trials Search API

## Overview
Create a FastAPI-based API that enables natural language search on ClinicalTrials.gov data using Large Language Models (LLMs) via OpenAI's Responses API.

## Goals
- Build a robust API that can interpret natural language queries about clinical trials
- Leverage LLMs to understand search intent and context beyond keyword matching
- Provide relevant clinical trial matches based on user queries
- Ensure high performance and reliability
- Support clinical researchers and patients in finding suitable trials
- Implement robust request tracking via correlation IDs
- Provide both REST API and CLI interfaces

## Requirements

### Technical Stack
- **FastAPI**: Core web framework for API development
- **SQLModel**: Database ORM for structured data
- **Pydantic BaseModel**: Schema validation and documentation
- **Pydantic Settings**: Configuration management
- **Python 3.12+**: Base programming language
- **OpenAI Responses API**: LLM integration for natural language understanding
- **PostgreSQL**: Primary database for storing structured data
- **Alembic**: Database migration management with safety checks
- **Typer**: CLI framework for command-line interface
- **Rich**: Terminal output formatting for CLI

### Paradigm
- **MVC**: Thin view supporting router, rate limit, tracing. Implementations in controller. Model in DB.
- **Domain-Driven Design**: Organize code by business domain for maintainability
- **Statically typed**: Fully statically typed with modern Python type annotations
- **Fully async with app created using factory**: Asynchronous architecture for high performance

### DevOps & Infrastructure
- **CI/CD Pipeline**: GitHub Actions for automated testing and deployment
- **AWS**: Cloud hosting infrastructure
- **Local Development**: Virtual environments with uv package manager
- **Pre-commit hooks**: Automated code quality checks

### Quality Assurance
- **Unit Testing**: PyTest for component validation
- **Test orchestration**: Tox for consistent test execution
- **Linting**: Ruff for fast Python linting
- **Type checking**: Mypy for static type validation
- **Integration Testing**: Test API endpoints and data flows
- **Mocking**: Simulate LLM responses for consistent testing
- **Test database**: Isolated test database for integration tests

### Security
- **Correlation IDs**: Mandatory for all API requests (except health checks)
- **Two-tier Rate Limiting**: Global rate limits and per-correlation-ID rate limits
- **Input Validation**: Thorough request validation with Pydantic
- **Audit Logging**: Track all system access and changes with correlation ID

### API Documentation
- **OpenAPI/Swagger**: Interactive API documentation auto-generated by FastAPI
- **Markdown Guides**: Comprehensive documentation for developers
- **Development Standards**: Explicit coding standards documentation
- **API Usage Examples**: Curl examples for common operations

### API Endpoints
- **Health Check**: `GET /api/health` for service monitoring
- **Search Endpoint**: To be implemented for natural language clinical trial search
- **Authentication**: To be implemented based on client requirements
- **All endpoints**: Require X-Correlation-ID header for request tracking

### CLI
- Commands for searching clinical trials directly from the terminal
- Configuration display and management
- Support for the same natural language queries as the API
- Rich formatted output for better readability

### Additional Features
- **Correlation ID Tracking**: End-to-end request tracing
- **Database Migration Safety**: Confirmation system to prevent accidental migrations
- **Modern Type Annotations**: Using Python 3.12+ syntax (e.g., `list[str]` not `List[str]`)
- **Comprehensive Error Handling**: Structured exception management
- **Request/Response Timing**: Performance tracking via middleware